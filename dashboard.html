<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control | Aura Elite</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    </head>
<body>

    <div id="app-container">
        
        <aside id="sidebar">
            <div class="logo-dashboard">
                <a href="dashboard.html">
                    <h1>Aura Elite</h1>
                </a>
            </div>

            <nav class="main-menu">
                <ul>
                    <li><a href="dashboard.html" class="active">üè† Inicio</a></li>
                    <li><a href="calendario.html">üìÖ Calendario</a></li>
                    <li><a href="clientes.html">üë• Clientes</a></li>
                    <li><a href="facturas.html">üí∞ Facturaci√≥n</a></li>
                    <li><a href="ficheros.html">‚òÅÔ∏è Ficheros (Drive)</a></li>
                    <li><a href="perfil.html">‚öôÔ∏è Configuraci√≥n</a></li>
                </ul>
            </nav>

            <div class="user-info">
                <p>Prof(a). <span id="user-display-name">Usuario</span></p>
                <a href="#" id="btn-logout" style="color: #ff6b6b;">Cerrar Sesi√≥n</a>
            </div>
        </aside>

        <div id="main-content">
            
            <div id="topbar">
                <button id="btn-menu-mobile" style="display: none; background:none; border:none; font-size:24px; cursor:pointer; margin-right:15px; color: #154360;">
                    ‚ò∞
                </button>

                <h2 id="page-title">Panel de Control</h2>
                
                <div class="user-actions">
                    <button id="btn-new-appointment" class="btn-primary" onclick="window.location.href='calendario.html'">+ Nueva Cita</button>
                </div>
            </div>

            <div class="content-area">
                
                <div class="dashboard-section">
                    <h3>üëã Hola, bienvenido a tu gesti√≥n.</h3>
                    <p style="margin-bottom: 20px; color: #666;">Selecciona una opci√≥n r√°pida para empezar:</p>

                    <div class="features-grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; display: grid;">
                        
                        <div class="feature-block" onclick="window.location.href='calendario.html'" style="cursor:pointer; padding: 15px;">
                            <div style="font-size: 2rem;">üìÖ</div>
                            <h4>Agenda</h4>
                            <p style="font-size: 0.8rem;">Ver citas</p>
                        </div>

                        <div class="feature-block" onclick="window.location.href='clientes.html'" style="cursor:pointer; padding: 15px;">
                            <div style="font-size: 2rem;">üë•</div>
                            <h4>Clientes</h4>
                            <p style="font-size: 0.8rem;">Nuevo paciente</p>
                        </div>

                        <div class="feature-block" onclick="window.location.href='facturas.html'" style="cursor:pointer; padding: 15px;">
                            <div style="font-size: 2rem;">üí∞</div>
                            <h4>Facturar</h4>
                            <p style="font-size: 0.8rem;">Crear recibo</p>
                        </div>

                         <div class="feature-block" onclick="window.location.href='ficheros.html'" style="cursor:pointer; padding: 15px;">
                            <div style="font-size: 2rem;">‚òÅÔ∏è</div>
                            <h4>Archivos</h4>
                            <p style="font-size: 0.8rem;">Ver Drive</p>
                        </div>

                    </div>
                </div>

                <div class="billing-summary-grid">
                    <div class="summary-card">
                        <h4>Ingresos Mes</h4>
                        <div class="summary-value" id="dash-ingresos-mes">$0.00</div>
                    </div>
                    <div class="summary-card">
                        <h4>Total Clientes</h4>
                        <div class="summary-value" id="dash-total-pacientes">0</div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Funcionalidad del Men√∫ M√≥vil
            const btnMenu = document.getElementById('btn-menu-mobile');
            const sidebar = document.getElementById('sidebar');

            if(btnMenu && sidebar) {
                btnMenu.addEventListener('click', (e) => {
                    e.stopPropagation(); // Evita que el clic se propague al documento
                    sidebar.classList.toggle('active');
                    console.log("Men√∫ clickeado, clase active:", sidebar.classList.contains('active'));
                });

                // Cerrar al hacer clic fuera
                document.addEventListener('click', (e) => {
                    if(window.innerWidth < 768 && 
                       sidebar.classList.contains('active') && 
                       !sidebar.contains(e.target) && 
                       e.target !== btnMenu) {
                        sidebar.classList.remove('active');
                    }
                });
            }

            // 2. Cargar datos del usuario
            const userJson = localStorage.getItem('aura_elite_user');
            if (userJson) {
                const user = JSON.parse(userJson);
                const nameDisplay = document.getElementById('user-display-name');
                if(nameDisplay) nameDisplay.innerText = user.name.split(' ')[0]; // Solo el primer nombre
            }
        });
    </script>
    <script>
        // SCRIPT DE EMERGENCIA PARA EL MEN√ö
        document.addEventListener("DOMContentLoaded", function() {
            console.log("Iniciando script de men√∫...");
            
            var btn = document.getElementById("btn-menu-mobile");
            var sidebar = document.getElementById("sidebar");

            if (btn && sidebar) {
                // Forzamos un clon del bot√≥n para eliminar eventos viejos que fallen
                var newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                
                newBtn.addEventListener("click", function(e) {
                    e.preventDefault();
                    e.stopPropagation(); // Evitar que otros clics interfieran
                    
                    if (sidebar.classList.contains("active")) {
                        sidebar.classList.remove("active");
                    } else {
                        sidebar.classList.add("active");
                    }
                    console.log("Men√∫ pulsado. Estado active:", sidebar.classList.contains("active"));
                });

                // Cerrar al tocar fuera
                document.addEventListener("click", function(e) {
                    if (window.innerWidth < 768 && 
                        sidebar.classList.contains("active") && 
                        !sidebar.contains(e.target) && 
                        e.target !== newBtn) {
                        sidebar.classList.remove("active");
                    }
                });
            } else {
                console.error("No encuentro el bot√≥n o el sidebar en este HTML");
            }
        });
    </script>
</body>
</html>