<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n | Aura Elite</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>

    <div id="app-container">
        
        <aside id="sidebar">
            <div class="logo-dashboard"><a href="dashboard.html"><h1>Aura Elite</h1></a></div>
            <nav class="main-menu">
                <ul>
                    <li><a href="dashboard.html">üè† Inicio</a></li>
                    <li><a href="calendario.html">üìÖ Calendario</a></li>
                    <li><a href="clientes.html">üë• Clientes</a></li>
                    <li><a href="facturas.html">üíµ Facturaci√≥n</a></li>
                    <li><a href="ficheros.html">‚òÅÔ∏è Ficheros (Drive)</a></li>
                    <li><a href="perfil.html" class="active" style="color:#FF6347;">‚öôÔ∏è Configuraci√≥n</a></li>
                </ul>
            </nav>
            <div class="user-info">
                <p>Prof(a). <span id="user-display-name">Usuario</span></p>
                <a href="#" id="btn-logout" style="color: #ff6b6b;">Cerrar Sesi√≥n</a>
            </div>
        </aside>

        <section id="main-content">
            <header id="topbar">
                <button id="btn-menu-mobile" style="display: none;">‚ò∞</button>
                <h2>Configuraci√≥n de Negocio</h2>
                <button onclick="saveProfile()" class="btn-primary">üíæ Guardar Cambios</button>
            </header>
            
            <div class="content-area">
                <div class="feature-block" style="text-align: left; max-width: 800px; margin: 0 auto;">
                    <h3 style="color: #154360; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px;">
                        üè¶ Datos Fiscales (Para Facturas)
                    </h3>
                    
                    <form id="profile-form">
                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="font-weight:bold;">Nombre o Raz√≥n Social:</label>
                            <input type="text" id="biz-name" placeholder="Ej: Consultorio Dr. P√©rez" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="font-weight:bold;">RIF / Documento Fiscal:</label>
                            <input type="text" id="biz-rif" placeholder="Ej: J-12345678-0" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="font-weight:bold;">Direcci√≥n Fiscal Completa:</label>
                            <textarea id="biz-address" rows="3" placeholder="Ej: Av. Principal..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>

                        <div class="form-group" style="margin-bottom: 15px;">
                            <label style="font-weight:bold;">Tel√©fono de Contacto:</label>
                            <input type="text" id="biz-phone" placeholder="Ej: 0414-0000000" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>

                        <div class="form-group" style="margin-bottom: 15px; border: 1px dashed #ccc; padding: 15px; background: #f9f9f9;">
                            <label style="font-weight:bold;">Logo del Negocio (Imagen):</label>
                            <input type="file" id="biz-logo-file" accept="image/*" style="margin-top: 10px;">
                            <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">* Sube una imagen (JPG/PNG). Se usar√° autom√°ticamente en los PDF.</p>
                            
                            <div id="logo-preview-container" style="margin-top: 10px; display: none;">
                                <p>Logo actual:</p>
                                <img id="logo-preview" src="" style="max-width: 150px; border: 1px solid #ddd; padding: 5px; background: white;">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </div>

    <script src="assets/js/app.js"></script>

    <script>
        // SCRIPT ESPECIAL PARA GESTIONAR LA IMAGEN
        document.addEventListener('DOMContentLoaded', () => {
            loadProfile();
        });

        // Variable para guardar la imagen en formato texto (Base64)
        let currentLogoBase64 = "";

        // Detectar cuando el usuario selecciona una imagen
        document.getElementById('biz-logo-file').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentLogoBase64 = e.target.result; // Guardamos la imagen convertida
                    // Mostrar preview
                    const preview = document.getElementById('logo-preview');
                    preview.src = currentLogoBase64;
                    document.getElementById('logo-preview-container').style.display = 'block';
                };
                reader.readAsDataURL(file); // Magia: Convierte archivo a texto
            }
        });

        function saveProfile() {
            const profile = {
                name: document.getElementById('biz-name').value,
                rif: document.getElementById('biz-rif').value,
                address: document.getElementById('biz-address').value,
                phone: document.getElementById('biz-phone').value,
                logo: currentLogoBase64 // Guardamos la imagen convertida
            };
            
            localStorage.setItem('aura_business_profile', JSON.stringify(profile));
            alert("‚úÖ Datos y Logo guardados correctamente.");
        }

        function loadProfile() {
            const data = localStorage.getItem('aura_business_profile');
            if (data) {
                const p = JSON.parse(data);
                document.getElementById('biz-name').value = p.name || '';
                document.getElementById('biz-rif').value = p.rif || '';
                document.getElementById('biz-address').value = p.address || '';
                document.getElementById('biz-phone').value = p.phone || '';
                
                // Cargar Logo si existe
                if (p.logo) {
                    currentLogoBase64 = p.logo;
                    const preview = document.getElementById('logo-preview');
                    preview.src = p.logo;
                    document.getElementById('logo-preview-container').style.display = 'block';
                }
            }
        }
    </script>
</body>
</html>