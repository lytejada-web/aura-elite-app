<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario | Aura Elite</title> 
    <link rel="stylesheet" href="assets/css/styles.css"> 
    
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
</head>
<body>

    <div id="app-container">
        
        <aside id="sidebar">
            <div class="logo-dashboard">
                <a href="dashboard.html">
                    <h1>Aura Elite</h1>
                </a>
            </div>
            <nav class="main-menu">
                <ul>
                    <li><a href="dashboard.html">üè† Inicio</a></li>
                    <li><a href="calendario.html" class="active">üìÖ Calendario</a></li>
                    <li><a href="clientes.html">üë§ Clientes</a></li> 
                    <li><a href="facturas.html">üíµ Facturaci√≥n</a></li>
                    <li><a href="ficheros.html">‚òÅÔ∏è Ficheros (Drive)</a></li>
                </ul>
            </nav>
            <div class="user-info">
                <p>Prof(a). <span id="user-display-name">Usuario</span></p>
                <a href="#" id="btn-logout" style="color: #ff6b6b;">Cerrar Sesi√≥n</a>
            </div>
        </aside>

        <section id="main-content">
            
            <header id="topbar">
                <button id="btn-menu-mobile" style="display: none;">
                    ‚ò∞
                </button>
                <h2>Calendario y Citas</h2>
                <button id="btn-new-appointment" class="btn-primary">‚ûï Nueva Cita</button> 
            </header>
            
            <div class="content-area">
                <div id="calendar-container">
                    <div id="full-calendar-display"></div> 
                </div>
            </div>
            
        </section>
        
    </div>

    <div id="new-appointment-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; color: #154360;">üìÖ Gesti√≥n de Cita</h2>
            
            <form id="appointment-form">
                <input type="hidden" id="appointment-id">

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="paciente-id" style="display:block; font-weight: bold; margin-bottom: 5px;">Cliente:</label>
                    <select id="paciente-id" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                        <option>Cargando...</option>
                    </select>
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="cita-titulo" style="display:block; font-weight: bold; margin-bottom: 5px;">Motivo / Tratamiento:</label>
                    <input type="text" id="cita-titulo" required placeholder="Ej: Limpieza, Ortodoncia..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display:block; font-weight: bold; margin-bottom: 5px;">Inicio:</label>
                        <input type="datetime-local" id="fecha-inicio" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display:block; font-weight: bold; margin-bottom: 5px;">Fin:</label>
                        <input type="datetime-local" id="fecha-fin" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>

                <button type="submit" class="btn-primary" style="width: 100%; padding: 12px;">üíæ Guardar Cita</button>
            </form>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // L√≥gica del Men√∫ M√≥vil
            var btn = document.getElementById("btn-menu-mobile");
            var sidebar = document.getElementById("sidebar");

            if (btn && sidebar) {
                btn.addEventListener("click", function(e) {
                    e.preventDefault(); e.stopPropagation();
                    sidebar.classList.toggle("active");
                });

                document.addEventListener("click", function(e) {
                    if (window.innerWidth < 768 && sidebar.classList.contains("active") && !sidebar.contains(e.target) && e.target !== btn) {
                        sidebar.classList.remove("active");
                    }
                });
            }

            // Cargar nombre de usuario
            const userJson = localStorage.getItem('aura_elite_user');
            if (userJson) {
                const user = JSON.parse(userJson);
                const nameDisplay = document.getElementById('user-display-name');
                if(nameDisplay) nameDisplay.innerText = user.name.split(' ')[0];
            }
            
            // Bot√≥n logout
            const btnLogout = document.getElementById('btn-logout');
            if(btnLogout) btnLogout.onclick = () => { localStorage.removeItem('aura_elite_token'); window.location.href = 'login.html'; };
        });
    </script>
    <script>
        // SCRIPT DE EMERGENCIA PARA EL MEN√ö
        document.addEventListener("DOMContentLoaded", function() {
            console.log("Iniciando script de men√∫...");
            
            var btn = document.getElementById("btn-menu-mobile");
            var sidebar = document.getElementById("sidebar");

            if (btn && sidebar) {
                // Forzamos un clon del bot√≥n para eliminar eventos viejos que fallen
                var newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                
                newBtn.addEventListener("click", function(e) {
                    e.preventDefault();
                    e.stopPropagation(); // Evitar que otros clics interfieran
                    
                    if (sidebar.classList.contains("active")) {
                        sidebar.classList.remove("active");
                    } else {
                        sidebar.classList.add("active");
                    }
                    console.log("Men√∫ pulsado. Estado active:", sidebar.classList.contains("active"));
                });

                // Cerrar al tocar fuera
                document.addEventListener("click", function(e) {
                    if (window.innerWidth < 768 && 
                        sidebar.classList.contains("active") && 
                        !sidebar.contains(e.target) && 
                        e.target !== newBtn) {
                        sidebar.classList.remove("active");
                    }
                });
            } else {
                console.error("No encuentro el bot√≥n o el sidebar en este HTML");
            }
        });
    </script>
</body>
</html>